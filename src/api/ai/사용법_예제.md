# Cloudflare Workers AI ê³ ê¸‰ ì‚¬ìš©ë²• ê°€ì´ë“œ

ì´ ë¬¸ì„œëŠ” í–¥ìƒëœ DestinyTellerApiì˜ ê³ ê¸‰ ê¸°ëŠ¥ë“¤ì„ í™œìš©í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸš€ ì£¼ìš” ê°œì„ ì‚¬í•­

### 1. AI Gateway í†µí•©
- ìš”ì²­/ì‘ë‹µ ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§
- ìë™ ìºì‹±ìœ¼ë¡œ ì„±ëŠ¥ í–¥ìƒ
- ì¬ì‹œë„ ë¡œì§ê³¼ í´ë°± ëª¨ë¸ ì„¤ì •
- ì‚¬ìš©ëŸ‰ ë¶„ì„ ë° ë¹„ìš© ìµœì í™”

### 2. ê³ ê¸‰ íŒŒë¼ë¯¸í„° ì§€ì›
- ë” ì •ë°€í•œ í…ìŠ¤íŠ¸ ìƒì„± ì œì–´
- ì¬í˜„ ê°€ëŠ¥í•œ ê²°ê³¼ë¥¼ ìœ„í•œ ì‹œë“œ ì„¤ì •
- ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì§€ì›

### 3. ìë™ í´ë°± ì‹œìŠ¤í…œ
- ì£¼ ëª¨ë¸ ì‹¤íŒ¨ ì‹œ ìë™ìœ¼ë¡œ ëŒ€ì²´ ëª¨ë¸ ì‚¬ìš©
- ì‚¬ì£¼ ë¶„ì„ì— ìµœì í™”ëœ ëª¨ë¸ ì„ íƒ ë¡œì§

### 4. ë™ì  ëª¨ë¸ ê²€ìƒ‰
- ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë¸ ì‹¤ì‹œê°„ ì¡°íšŒ
- ì‚¬ì£¼ ë¶„ì„ ì í•©ì„± ì ìˆ˜ ê¸°ë°˜ ì¶”ì²œ

## ğŸ“ ì‚¬ìš© ì˜ˆì œ

### ê¸°ë³¸ ì‚¬ìš©ë²• (ê¸°ì¡´ê³¼ ë™ì¼)

```javascript
const response = await fetch('/api/detailed-fortune-telling', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    systemPrompt: "ë‹¹ì‹ ì€ ì „ë¬¸ ì‚¬ì£¼ëª…ë¦¬í•™ìì…ë‹ˆë‹¤.",
    userPrompt: "1990ë…„ 3ì›” 15ì¼ ì˜¤ì „ 10ì‹œ ì„œìš¸ ì¶œìƒìì˜ ì‚¬ì£¼ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”.",
    max_tokens: 1500,
    temperature: 0.3
  })
});
```

### AI Gateway ì‚¬ìš© (ê¶Œì¥)

```javascript
const response = await fetch('/api/detailed-fortune-telling', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    systemPrompt: "ë‹¹ì‹ ì€ ì „ë¬¸ ì‚¬ì£¼ëª…ë¦¬í•™ìì…ë‹ˆë‹¤.",
    userPrompt: "1990ë…„ 3ì›” 15ì¼ ì˜¤ì „ 10ì‹œ ì„œìš¸ ì¶œìƒìì˜ ì‚¬ì£¼ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”.",
    max_tokens: 2000,
    temperature: 0.4,
    
    // ğŸ†• AI Gateway ì„¤ì •
    useGateway: true,
    gatewayId: "saju-analysis-gateway", // Cloudflare ëŒ€ì‹œë³´ë“œì—ì„œ ìƒì„±í•œ Gateway ID
    
    // ğŸ†• ê³ ê¸‰ ì˜µì…˜ë“¤
    top_p: 0.9,              // ë” ì°½ì˜ì ì¸ ì‘ë‹µ
    frequency_penalty: -0.1,  // ë°˜ë³µ ì¤„ì´ê¸°
    presence_penalty: 0.1,    // ìƒˆë¡œìš´ ì£¼ì œ ì¥ë ¤
    seed: 12345,             // ì¬í˜„ ê°€ëŠ¥í•œ ê²°ê³¼
    enableFallback: true     // í´ë°± ëª¨ë¸ ì‚¬ìš©
  })
});

const result = await response.json();

// ğŸ” ì‘ë‹µì—ëŠ” ì¶”ê°€ ë©”íƒ€ë°ì´í„° í¬í•¨
console.log('ì‚¬ìš©ëœ ëª¨ë¸:', result.metadata.model_used);
console.log('Gateway ì‚¬ìš©:', result.metadata.gateway_enabled);
console.log('í´ë°± ì‚¬ìš©:', result.metadata.fallback_used);
```

### ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì‚¬ìš©

```javascript
const response = await fetch('/api/detailed-fortune-telling', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    systemPrompt: "ë‹¹ì‹ ì€ ì „ë¬¸ ì‚¬ì£¼ëª…ë¦¬í•™ìì…ë‹ˆë‹¤.",
    userPrompt: "ì‚¬ì£¼ ë¶„ì„ì„ ë‹¨ê³„ë³„ë¡œ ìì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”.",
    
    // ğŸ†• ìŠ¤íŠ¸ë¦¬ë° ì„¤ì •
    stream: true,
    max_tokens: 3000,
    temperature: 0.5
  })
});

// ìŠ¤íŠ¸ë¦¬ë° ë°ì´í„° ì²˜ë¦¬
const reader = response.body.getReader();
while (true) {
  const { done, value } = await reader.read();
  if (done) break;
  
  const chunk = new TextDecoder().decode(value);
  // ì‹¤ì‹œê°„ìœ¼ë¡œ ì‘ë‹µ í‘œì‹œ
  console.log('ìŠ¤íŠ¸ë¦¼ ë°ì´í„°:', chunk);
}
```

### íŠ¹ì • ëª¨ë¸ ì„ íƒ

```javascript
const response = await fetch('/api/detailed-fortune-telling', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    systemPrompt: "ë‹¹ì‹ ì€ ì „ë¬¸ ì‚¬ì£¼ëª…ë¦¬í•™ìì…ë‹ˆë‹¤.",
    userPrompt: "ë³µì¡í•œ ì‚¬ì£¼ ë¶„ì„ì„ í•´ì£¼ì„¸ìš”.",
    
    // ğŸ†• íŠ¹ì • ëª¨ë¸ ì„ íƒ
    model: "@cf/qwen/qwen2.5-coder-32b-instruct", // ë…¼ë¦¬ì  ì‚¬ê³ ì— ê°•í•œ ëª¨ë¸
    max_tokens: 2500,
    temperature: 0.2, // ë” ì¼ê´€ëœ ë¶„ì„
    
    // ì •ë°€í•œ ì œì–´
    top_p: 0.8,
    frequency_penalty: 0.0,
    presence_penalty: 0.2
  })
});
```

### ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë¸ ì¡°íšŒ

```javascript
// ëª¨ë“  ëª¨ë¸ ì¡°íšŒ
const modelsResponse = await fetch('/api/ai-models');
const modelsData = await modelsResponse.json();

console.log('ì´ ëª¨ë¸ ìˆ˜:', modelsData.total_count);
console.log('ì‚¬ì£¼ ë¶„ì„ ì¶”ì²œ ëª¨ë¸:', modelsData.recommended_models);

// íŠ¹ì • ì œê³µì—…ì²´ ëª¨ë¸ë§Œ ì¡°íšŒ
const metaModelsResponse = await fetch('/api/ai-models?provider=meta');
const metaModelsData = await metaModelsResponse.json();

// í…ìŠ¤íŠ¸ ìƒì„± ëª¨ë¸ë§Œ ì¡°íšŒ
const textModelsResponse = await fetch('/api/ai-models?category=text-generation');
const textModelsData = await textModelsResponse.json();
```

### ë””ë²„ê¹…ì„ ìœ„í•œ ì›ì‹œ ì‘ë‹µ

```javascript
const response = await fetch('/api/detailed-fortune-telling', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    systemPrompt: "ë‹¹ì‹ ì€ ì „ë¬¸ ì‚¬ì£¼ëª…ë¦¬í•™ìì…ë‹ˆë‹¤.",
    userPrompt: "ì‚¬ì£¼ ë¶„ì„ì„ í•´ì£¼ì„¸ìš”.",
    
    // ğŸ†• ì›ì‹œ ì‘ë‹µ ë°˜í™˜ (ë””ë²„ê¹…ìš©)
    returnRawResponse: true,
    max_tokens: 1000
  })
});

// ì›ì‹œ Response ê°ì²´ì— ì ‘ê·¼ ê°€ëŠ¥
const rawData = await response.json();
console.log('ì‘ë‹µ í—¤ë”:', rawData.headers);
console.log('ìƒíƒœ ì½”ë“œ:', rawData.status);
```

## ğŸ¯ ëª¨ë¸ë³„ íŠ¹ì„± ë° ê¶Œì¥ ì‚¬ìš©ë²•

### 1. @cf/deepseek-ai/deepseek-r1-distill-qwen-32b (ê¸°ë³¸)
- **íŠ¹ì§•**: ì¶”ë¡ ê³¼ ì‚¬ê³  ê³¼ì •ì— íŠ¹í™”
- **ì‚¬ì£¼ ë¶„ì„ ì í•©ì„±**: â­â­â­â­â­
- **ê¶Œì¥ ì„¤ì •**: temperature: 0.3-0.5, max_tokens: 1500-2500

### 2. @cf/qwen/qwen2.5-coder-32b-instruct
- **íŠ¹ì§•**: ë…¼ë¦¬ì , êµ¬ì¡°ì  ì‚¬ê³ ì— ê°•í•¨
- **ì‚¬ì£¼ ë¶„ì„ ì í•©ì„±**: â­â­â­â­â­
- **ê¶Œì¥ ì„¤ì •**: temperature: 0.2-0.4, top_p: 0.8

### 3. @cf/meta/llama-3.1-8b-instruct
- **íŠ¹ì§•**: ëŒ€í™”í˜• ìƒí˜¸ì‘ìš©ì— ìµœì í™”
- **ì‚¬ì£¼ ë¶„ì„ ì í•©ì„±**: â­â­â­â­
- **ê¶Œì¥ ì„¤ì •**: temperature: 0.4-0.6, presence_penalty: 0.1

### 4. @cf/google/gemma-7b-it
- **íŠ¹ì§•**: íš¨ìœ¨ì ì´ê³  ë¹ ë¥¸ ì¶”ë¡ 
- **ì‚¬ì£¼ ë¶„ì„ ì í•©ì„±**: â­â­â­
- **ê¶Œì¥ ì„¤ì •**: ë¹ ë¥¸ ì‘ë‹µì´ í•„ìš”í•œ ê²½ìš° ì‚¬ìš©

## ğŸ’¡ ìµœì í™” íŒ

### ë¹„ìš© ìµœì í™”
```javascript
{
  // ì§§ì€ ë¶„ì„ìš© - ë¹„ìš© íš¨ìœ¨ì 
  max_tokens: 800,
  temperature: 0.3,
  model: "@cf/google/gemma-7b-it"
}

{
  // ìƒì„¸í•œ ë¶„ì„ìš© - í’ˆì§ˆ ìš°ì„ 
  max_tokens: 2500,
  temperature: 0.4,
  model: "@cf/qwen/qwen2.5-coder-32b-instruct",
  useGateway: true // ìºì‹±ìœ¼ë¡œ ë°˜ë³µ ìš”ì²­ ë¹„ìš© ì ˆì•½
}
```

### ì„±ëŠ¥ ìµœì í™”
```javascript
{
  // Gateway ìºì‹± í™œìš©
  useGateway: true,
  gatewayId: "saju-cache-gateway",
  
  // ì¬í˜„ ê°€ëŠ¥í•œ ê²°ê³¼ (ìºì‹± íš¨ìœ¨ì„± í–¥ìƒ)
  seed: Math.floor(Date.now() / 1000), // ì‹œê°„ ê¸°ë°˜ ì‹œë“œ
  
  // í´ë°± ì‹œìŠ¤í…œ í™œì„±í™”
  enableFallback: true
}
```

### í’ˆì§ˆ ìµœì í™”
```javascript
{
  // ì¼ê´€ì„± ìˆëŠ” ë¶„ì„
  temperature: 0.2,
  top_p: 0.8,
  frequency_penalty: 0.1,
  
  // ë…¼ë¦¬ì  ì‚¬ê³  ëª¨ë¸ ì‚¬ìš©
  model: "@cf/qwen/qwen2.5-coder-32b-instruct",
  
  // ì¶©ë¶„í•œ í† í° í• ë‹¹
  max_tokens: 2000
}
```

## ğŸ” ì‘ë‹µ í—¤ë” ì •ë³´

ì‘ë‹µ í—¤ë”ë¥¼ í†µí•´ ì¶”ê°€ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```javascript
const response = await fetch('/api/detailed-fortune-telling', { /* ... */ });

console.log('ì‚¬ìš©ëœ ëª¨ë¸:', response.headers.get('X-AI-Model'));
console.log('Gateway ì‚¬ìš©:', response.headers.get('X-Gateway-Enabled'));
console.log('í´ë°± ì‚¬ìš©:', response.headers.get('X-Fallback-Used'));
```

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **Gateway ID**: Cloudflare ëŒ€ì‹œë³´ë“œì—ì„œ ë¯¸ë¦¬ ì„¤ì •í•œ Gateway IDë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
2. **ëª¨ë¸ ê°€ìš©ì„±**: ì¼ë¶€ ëª¨ë¸ì€ ì§€ì—­ì´ë‚˜ í”Œëœì— ë”°ë¼ ì‚¬ìš©í•  ìˆ˜ ì—†ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
3. **í† í° ì œí•œ**: ëª¨ë¸ë³„ë¡œ ìµœëŒ€ í† í° ìˆ˜ê°€ ë‹¤ë¥´ë¯€ë¡œ í™•ì¸ í›„ ì‚¬ìš©í•˜ì„¸ìš”.
4. **ë¹„ìš© ëª¨ë‹ˆí„°ë§**: ê³ ê¸‰ ê¸°ëŠ¥ ì‚¬ìš© ì‹œ ë¹„ìš©ì´ ì¦ê°€í•  ìˆ˜ ìˆìœ¼ë‹ˆ ëª¨ë‹ˆí„°ë§í•˜ì„¸ìš”.

## ğŸ“Š ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

Gatewayë¥¼ ì‚¬ìš©í•˜ë©´ Cloudflare ëŒ€ì‹œë³´ë“œì—ì„œ ë‹¤ìŒ ì •ë³´ë¥¼ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- ìš”ì²­ íšŸìˆ˜ ë° ì„±ê³µë¥ 
- í‰ê·  ì‘ë‹µ ì‹œê°„
- í† í° ì‚¬ìš©ëŸ‰ í†µê³„
- ëª¨ë¸ë³„ ì„±ëŠ¥ ë¹„êµ
- ë¹„ìš© ë¶„ì„

ì´ëŸ¬í•œ ê³ ê¸‰ ê¸°ëŠ¥ë“¤ì„ í™œìš©í•˜ì—¬ ë” ì•ˆì •ì ì´ê³  íš¨ìœ¨ì ì¸ ì‚¬ì£¼ ë¶„ì„ ì„œë¹„ìŠ¤ë¥¼ êµ¬ì¶•í•˜ì„¸ìš”! 